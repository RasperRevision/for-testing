<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rasper Revision</title>

  <!-- FAVICON -->
  <link rel="icon" type="image/png" href="/assets/favicon.png">

  <!-- BOOTSTRAP STYLES -->
  <link href="bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- BOOTSTRAP SCRIPTS-->
  <script src="bootstrap.bundle.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"
    defer></script>

  <!-- BOOTSTRAP ICONS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- STYLES -->
  <link href="style.css" rel="stylesheet">
</head>

<body style="overflow-y: hidden;">
  <div class="flex_col main_wrapper">
    <section class="flex_col">
      <div style="flex-grow:1;margin:50px;">
        <div class="modal fade" id="games-modal" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content dark">
              <div class="modal-header border-secondary">
                <h5 class="modal-title">Select an activity</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
              <div class="modal-body d-flex">
                <div class="card text-bg-dark border-secondary game">
                  <div class="card-body flex_col justify-content-between">
                    <div class="mb-1">Exam Questions</div>
                    <small>Exam questions from past papers by the major exam boards</small>
                    <button id="exam-questions" class="rbtn rasper-green m-0 mt-3"
                      onclick="startGame(this)">Begin</button>
                  </div>
                </div>
                <div class="card text-bg-dark border-secondary game">
                  <div class="card-body flex_col justify-content-between">
                    <div class="mb-1">Matchup</div>
                    <small>Match the questions to their answers and the questions to their definitions</small>
                    <button id="matchup" class="rbtn rasper-green m-0 mt-3" onclick="startGame(this)">Begin</button>
                  </div>
                </div>
                <div class="card text-bg-dark border-secondary game">
                  <div class="card-body flex_col justify-content-between">
                    <div class="mb-1">Quiz</div>
                    <small>Multiple choice quiz where you select the correct answer from 4 options</small>
                    <button id="quiz" class="rbtn rasper-green m-0 mt-3" onclick="startGame(this)">Begin</button>
                  </div>
                </div>
                <div class="card text-bg-dark border-secondary game">
                  <div class="card-body flex_col justify-content-between">
                    <div class="mb-1">Fill in the blank</div>
                    <small>Figure out which words go in the gaps in the incomplete quotation.</small>
                    <button id="blank" class="rbtn rasper-green m-0 mt-3" onclick="startGame(this)">Begin</button>
                  </div>
                </div>
                <div class="card text-bg-dark border-secondary game">
                  <div class="card-body flex_col justify-content-between">
                    <div class="mb-1">Equations</div>
                    <small>Try to recall the relationships between variables in these equations</small>
                    <button id="equations" class="rbtn rasper-green m-0 mt-3" onclick="startGame(this)">Begin</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="subjects container"></div>
      </div>
    </section>
  </div>

  <script src="sidebar.js"></script>
  <script>

    var topic_chosen = null;

    function startGame(btn) {
      console.log(btn.id)
      switch (btn.id) {
        case "matchup":
          location.href = `/matchup/?json=${topic_chosen}`;
          break;
        case "quiz":
          location.href = `/quiz/?json=${topic_chosen}`;
          break;
        case "blank":
          location.href = `/fill-in-the-blank?json=${topic_chosen}`;
          break;
        case "equations":
          location.href = '/equations?json=physics_equations.json';
          break;
        case "exam-questions":
          location.href = `/exam-questions?json=${topic_chosen}`;
          break;
      }
    }

    document.addEventListener("DOMContentLoaded", () => {

      createSubjectButtons();

      async function createSubjectButtons() {
        const data = await (await fetch('subjects.json')).json();

        const col = document.createElement('div');
        col.classList.add('home-col');
        document.querySelector('.subjects').append(col);

        data.forEach((subject, i) => {
          const subject_icon = document.createElement('img');
          subject_icon.classList.add('subject-icon');
          subject_icon.src = `icons/${subject.icon}`;

          const subject_btn = document.createElement('button');
          subject_btn.classList.add('subject-btn', 'w-100');
          subject_btn.appendChild(subject_icon);
          subject_btn.innerHTML += `<div class=d-inline>${subject.displayName}</div>`;

          const subject_wrapper = document.createElement('div');
          subject_wrapper.classList.add('subject-wrapper', i);
          subject_wrapper.appendChild(subject_btn);

          subject_btn.addEventListener('click', () => {
            if (!subject_wrapper.classList.contains('lg')) {
              col.childNodes.forEach(child => {
                if (child != subject_wrapper) child.style.transform = 'translateX(-100vw)';
              });
              col.prepend(subject_wrapper);

              const subject_content = document.createElement('div');
              subject_content.classList.add('w-100', 'px-1');
              subject_content.style.overflowY = 'hidden';
              setInterval(() => {
                subject_content.style.overflowY = 'auto';
              }, 500)
              subject_wrapper.appendChild(subject_content);

              var queue = [];

              subject.topics.forEach((topic, j) => {
                const topic_btn = document.createElement('button');
                topic_btn.classList.add('topic-btn');
                topic_btn.textContent = topic.displayName;
                topic_btn.style.border = 'none';

                topic_btn.style.borderBottom = '1px gray solid';

                if (topic.topics) var hasSubtopics = true;
                else {
                  topic_btn.setAttribute('data-bs-toggle', 'modal');
                  topic_btn.setAttribute('data-bs-target', '#games-modal');
                }

                topic_btn.addEventListener('click', () => {
                  if (hasSubtopics) {
                    subject_content.childNodes.forEach(child => child.remove());
                    topic.topics.forEach((subtopic, k) => {
                      const subtopic_btn = document.createElement('button');
                      subtopic_btn.classList.add('topic-btn');
                      subtopic_btn.textContent = subtopic.displayName;
                      subtopic_btn.style.border = 'none';
                      subtopic_btn.setAttribute('data-bs-toggle', 'modal');
                      subtopic_btn.setAttribute('data-bs-target', '#gamesModal');

                      subtopic_btn.addEventListener('click', () =>
                        topic_chosen = topic.jsonFile
                      );

                      if (j != topic.topics.length - 1) {
                        subtopic_btn.style.borderBottom = '1px gray solid';
                      }

                      subject_content.appendChild(subtopic_btn);
                    });
                  } else {
                    topic_chosen = topic.jsonFile;
                  }
                });
                if (topic.resource) queue.push(topic_btn);
                else subject_content.appendChild(topic_btn);
              });

              subject_content.children[subject_content.children.length - 1].style.borderBottom = 'none';

              if (queue[0]) {
                const resources_title = document.createElement('p');
                resources_title.classList.add('mt-4', 'fs-6')
                resources_title.textContent = 'Additional resources: ';
                subject_content.append(resources_title);

                queue.forEach(btn => subject_content.appendChild(btn));
              }

              subject_content.children[subject_content.children.length - 1].style.borderBottom = 'none';
            } else {
              col.insertBefore(subject_wrapper, col.children[parseInt(subject_wrapper.classList[1]) + 1]);
              col.childNodes.forEach(child => { child.style.transform = '' });
              subject_wrapper.childNodes.forEach(child => {
                if (!child.classList.contains('subject-btn')) child.remove();
              });
            }
            setTimeout(() => subject_wrapper.classList.toggle('lg'), 50);
          });

          col.appendChild(subject_wrapper);
        });
      }
    }); 
  </script>

</body>

</html>